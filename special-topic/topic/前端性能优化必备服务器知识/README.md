# 专题四.前端性能优化与工程化
## 内容提要
* 浏览器渲染过程
	- 还记得http协议吗？
		+ 处理流量
			1. 输入网址并回车
			2. 解析域名
			3. 浏览器发送http请求
			4. 服务器处理请求
			5. 服务器返回html响应
			6. 浏览器处理html页面
			7. 继续请求其他资源
	- 渲染流程（https://w3c.github.io/navigation-timing/）
		1. 浏览器-prompt for unload：[navigationstar]提示卸载，撬下回车的一瞬间
		2. 浏览器-redirect：[redirectStart]检查本地重定向（是否做了缓存）[redirectEnd]
			unload：[unloadStart]上一个页面卸载（屏幕擦出）[unloadEnd](资源还没有拿到手)
		3. 浏览器-app cache：[fetchStart:开始拿资源]取本地缓存（缓存没有过期直接跳到processing，过期了就会一步一步执行）
		4. 网络-DNS：[domainLookupStart]找到网络地址,瓶颈-快慢取决于用户设置的ip地址（解析时间长短）[domainLookupEnd]
		5. 网络-server-TCP：[connectStart]建立连接，三次握手(比较消耗资源)[secureConnectionStart:加密ssl/tls][connectEnd]
		6. 网络-server-request：[requestStart:http流程开始]发送请求，瓶颈2：受网络状态限制，数据量限制（就近原则：CDN技术）
		7. 网络-response：[responseStart][responseEnd]网络结束，可以拿到HTML文件资源（不是真正的DOM树）
		8. dom-processing：html、dom解析、事件、资源 - 放到内存中[domloading:文件解析成dom结点][domInteractive:dom树被完成后，加载内嵌的资源css、js、img...][domContentLoading：是一个时间节点，dom内容全部加在完毕][domComplete：加在完成，生成dom结构，是一个直接使用的结构，文档本身处理完了]
		9. dom-onload：第一个事件的触发 - 交给显卡 - 看到页面[loadEventStart：装载操作，处理事件][loadEventEnd：渲染器render就要干活了]
	- 
* DNS详解
	- DNS是Domain Name System，域名系统，用于将域名转换为ip
	- 顶级域名
	- 域名资源记录
	- 域名服务器：用于将域名转换为ip，就是大数据库（分为很多级别）
	- 域名解析：正向解析 - 域名转成ip。反向解析 - ip转成域名
	- Root server：根路由，解析的是com或者cn后缀
	- TLD server：保存着顶级域名，解析的是一级域名
	- Name server：保存着域名和ip对应表，返回二级以上域名
	- 阿里云技术快，世界第三
* 记录类型
	- SOA：（起始授权记录）一般不需要设置，一个区域解析库只能有一个SOA记录
	- A记录：（只能解析ipv4的地址）用于名称解析的重要记录，将特定的主机
	- AAAA记录：（ipv6主机记录）
	- CNAME记录：（别名记录）有大用。很多域名中的一个域名（A记录）指向同一个ip（其他域名指向这个域名，这样一来维护这些数据非常方便）
	- NS记录：（域名服务器记录）用来保存下一级域名（架设属于自己的域名服务器）
	- MX记录：（邮件记录）用来设定电子邮件，发件和收件之间的通信
* TCP三次握手与四次挥手
	- 数据接收端：
		1. 引用层
		2. 表示层
		3. 会话层
		4. 传输层
		5. 网络层
		6. 数据链路层
		7. 物理层
		+ 从下到上进行解封装
	- 数据发送端
		1. 应用层：AH
		2. 表示层：PH
		3. 会话层；SH
		4. 传输层(TCP/UDP)：TH
		5. 网络层(IP)：NH
		6. 数据链路层：DT
		7. 物理层：比特流（01）
		+ 从上到下进行封装
	- tcp 协议模型详解
		1. 应用层：文件传输、电子邮件、文件服务、虚拟终端
		2. 表示层：数据格式化、代码转换、数据加密
		3. 会话层：解除或建立与别的节点的联系
		4. 传输层：提供端对端的接口。 TCP UDP
		5. 网络层：为数据包选择路由。IP ICMP RIP OSPF BGP IGMP
		6. 数据链路层：传输有地址的帧以及错误检测功能。SLIP(串口)、ppp（上网拨号）arp（ip地址和mac对应）
		7. 物理层：以二进制数据形式在物理媒体上传输数据。ISO2110 IEEE802
		8. http头：（二进制数据，顺序号、应答号）至少24个字节:大块拆封成多个小块，分块分发，当遇到丢包现象，丢包的序号保存，接收端接收到重发指令，需要携带指令标号回传
	- 三次握手（编码系统的规则：不能重复，客户端和服务端游两套顺序号）
		1. 客户端携带顺序号发送给server
		2. server响应客户端的顺序号和发送应答号（客户端携带顺序号+1）发送给客户端
		3. 客户端发送应答号（server响应客户端的顺序号+1）
		4. 发起连接和断开连接请求都是由客户端发起的
	- 四次挥手
		1. 客户端发起fin请求（还有没有需要处理的请求）
		2. 服务器发送给客户端（收到断开请求的额包，响应断开请求的包，检查自己的活干完没有）
		3. 工作完成之后再向客户端发送断开确认包
		4. 客户端接收到后再向服务器断开确认包
	- 单工：当一方发送数据是，另一方则只能接收数据而不能发送数据（对讲机）
	- 双工：发送方和接收方可以同时发送数据（打电话）
* HTTP缓存机制
	- 缓存存在的意义就是为了节省网络的带宽和节省资源，浏览器里面有缓存数据库，网络通信时高消耗的io资源，受限与服务器的吞吐量和带宽
	- 强制缓存：不管服务器要不要求，都要缓存
	- 对比缓存：通过比较，是不是需要使用缓存。缓存标记判断缓存资源是否缓存，本地缓存的状态发送给服务器，服务器判断是否需要缓存
	- etag策略：http头里缓存表示，资源过期时给服务器发送信息，过期->资源重新推送；不过期->服务器返回304条转 优先级比较高 采用md5
	- last-mofified策略：一个时间戳，每个文件都有时间戳，过期->时间戳放到cache-control头里面请求服务器，比较时间戳不一致 -> 200成功，资源重新推送； 时间一致 -> 304调转（需要去缓存里拿）服务器的压力变小，为更多的客户服务，提高服务器性能
	- 配置在web服务器上，nginx
* CDN与集群
	- 为了解决延迟问题，就要分发，会产生镜像服务器（地理位置和路由进行优化）采用就近原则。ping一个域名时，ip地址也会不一样，这时候就是通过区域性的cdn解析。js、css的url

# http协议那些事
1. 当我们输入网址后发生了什么
	* http请求模型：client  <---请求req、响应res---> server（除了代理、dns、运营商劫持，一般不做操作）
	* 浏览器行为与http协议
		- 先穿透内网和外网，网络边界（内局域网，外intnet，防火墙：硬件防火墙非常贵、软防火墙软件-发送接收策略linux内核-六大系统、家用路由器-猫-电信ppt服务器、代理服务器）
		- dns解析：域名（是给人用的，自然语言）和ip地址（是给计算机用的），对他们进行映射-数据库-dns转换服务器（有很多手段提高速度），dns服务器的ip是内嵌到电脑的
		- 浏览器可以一路通行 - 链路（通过网管、路由器：透明设备，感觉不到）linux、mac-tracerout-ttl默认是64 window- traacert-ttl默认是256
		- 集群的出入口：从ip进去，反向代理根据http的请求转发到服务器上，服务器作出反应也就是响应传回到用户（来回路线有可能不一致）
		- 浏览器收到数据，浏览器进行内部处理（性能优化那儿讲）
		- 用户能看到浏览器传回来的数据
		- 处理流程：
			1. 输入网址并回车
			2. 解析域名 dns
			3. 浏览器发送http请求 
			4. 服务器处理请求
			5. 服务器返回html响应
			6. 浏览器处理html页面
			7. 继续请求其他资源，必须从html里面拿
	* 
2. http协议详解
	* 什么事http协议
		- http是超文本（有年头，不止ascii）传输协议（rfc是一种官方的解释，文档比较长），从www浏览器传输到本地浏览器的一种传输协议，网站是基于http协议的，例如网站的图片等、css、js等都是基于http协议进行传输的。
		- http协议是由从客户机到服务器的请求（request）和从服务器到客户机的响应（response）进行约束和规范
		- 1991 http/0.9
		- 1996 http/1.0
		- 1999 http/1.1：互联网泡沫 tcp
		- 2015 http/2：和http/1.0有什么区别，后面将 tcp
		- http/3 ucp
	* 了解tcp/ip协议栈（iso/osi 和 tcp/ip协议）
		- 应用层（应用层、表示层、绘画层）
			+ 直接由应用程序调用，为用户提供所需要的各种服务，例如：http、ftp、dns、smtp、ssh等
			+ https在会话层添加了安全
		- 传输层
			+ 为应用层实体提供端到端的通信功能，保证数据包的顺序传送及数据的完整性
			+ 该层定义了这个主要的协议：传输控制协议tcp和用户数据协议udp
		- 网络层 5g通信
			+ 主要解决主机到主机的通信问题，ip协议是
		- 网络接口层（数据链路层、物理层） 5g通信更多在此层
	* 在tcp/ip协议栈中的位置
		- http（tls、ssl：加密方案） - tcp（前端最多接触到此层） - ip - 数据链路层
		- 目前普通应用版本http1.1
		- 正在逐步向http2迁移
		- http默认的端口号为80
		- https默认端口号为443
	* http的工作过程
		- 事务：是计算机最重要的，它有一个特点：有一个操作，有若干步骤（1+），遵循一定顺序，任何一个步骤出现问题，所有的操作都失败，者这样操作就是事务。
		- 一次http操作称为一个事务，其工作过程可分为四步：
		- 1. 首先客户机与服务器需要建立连接（tcp连接）
		- 2. 客户机发送一个请求给服务器（有规律）
		- 3. 服务器接到请求后，给予响应的响应信息（有规律）
		- 4. 客户端接受服务器所返回的信息，然后客户机与服务器断开链接
		- 任何一个步骤出现错误，那么产生错误的信息将返回到客户端
	* 请求与响应
		- http请求组成：请求方法（get、post）、请求url、http协议及版本 \r(return - enter) \n(next) 、请求头\r \n、请求数据（get不带请求数据，把参数放在了url上、post是附加上去的）
		- http响应组成：报文协议机版本、状态码及状态描述、响应头、响应体（服务器响应回来的数据，是有起始标记和结束标记的，区分报文类型）
		- 抓包工具是tcp抓区的
	* 端到端
		- general：
			+ 请求行（url、method、address：每个人不一样）和响应行（status、）合起来了
		- request：
			+ accept：接受什么样格式的数据 */*什么都要
			+ accept-enoding：穿过来的数据是否接受压缩，gzip压缩格式，性能优化
			+ accept-language：浏览器接受的语言 简体中文
			+ cache-control：缓存相关 掠过
			+ connection：控制长链接（）和短链接（）：io操作是很慢的10的n次方，和cpu差好几个数量级，尽可能减少io，一次连接多个请求响应，长链接（keep-alive）
			+ cookie：请求时候是保存在本地的数据，key-value的形式存在
			+ host：服务器的域名，反爬虫手段（请求特征）
			+ referer：源头
			+ user-agent:识别浏览器（最早的浏览器（网景）），本质是要解决兼容性的
		- response：
			+ cache-control:
			+ connection:回应
			+ accept-enoding：
			+ content-type:返回的骨架是什么类型
			+ date：事件
			+ expires：缓存有关
			+ server：泄漏服务器的隐私
			+ set-cookie：是一行一行给的，有5个属性（规定浏览器cookie访问路径、能不能跨域、是不是私有的），有其他代码控制，请求使用键值对
			+ 安全性
			+ 兼容性的问题
	* 请求方法（restful可以看到这四个）
		- get：查
		- post：改
		- put：增
		- delete：删
		- head：没有响应体
		- trace：调试用的
		- connect：管道连接，代理服务器用的是这个
		- options：监控服务器性能的
	* http状态码（无状态协议 - 超时）
		- 1..: 后端异步：先响应给你，否则你会等待超时，还可以后续访问
		- 2..: 指示信息
		- 3..: 跳转相关的
		- 4..: 客户端错误：403没有权限操作
		- 5..: 服务器状态：反响代理服务器有问题（gateway）
3. cookie和session
	* cookie：是保存在客户端的小段文本，随客户端点每一个请求发送该url下的所有cookie到服务器端，是ascii码，是txt文档，绝大多数由服务器控制
	* session：是一个数据，必须存在于服务器端。用来维持会话。http是无状态，不能正确识别客户端，必须重新认证，所以需要使用session。解决链路的安全性。它是数据结构，保存在内存中（管理存在mysql、内存数据库中为了持久化）破解的代价
	* cookie使用
		- 与cookie相关的http扩展头
			+ cookie：客户端将服务器设置的cookie返回到服务器
			+ set-cookie：服务器向客户端设置cookie
		- 第一次访问时，没有携带cookie上传，服务器端需要生成id下发（set-cookie）给浏览器。第二次到底n次（只要不清楚cookie），携带cookie请求服务器，发现cookie里有对应的数据，处于登录张台，否则是退出状态。会话超时是有服务器端配置。
	* session的使用
		- 使用cookie来实现
		- 使用url回显来实现：移动web - wap是一种简化的web（当时的手机运算优先、内存小、cpu小）它把cookie省略了 登录通过url回显暂时实现cookie（存成书签）。url回显仍然有用，以taken形式存在（一直在变，网银上用）
		- 默认情况下生成JSESSIONID
4. http缓存机制
	* 缓存会根据请求保存输出内容的副本，例如html页面，图片，文件，当下一个请求来到的时候：如果是相同的url，缓存直接使用副本响应访问请求，而不是向源服务器再次发送请求。
	* 云服务器带宽最贵，网络资源最宝贵，想办法减少带宽的使用，首先数据压缩，第二是web访问的性质（更多静态资源重复logo、脚本、图片）
	* 返回304不带响应体，只有http头这部分
	* 缓存的优点：
		- 减少响应延迟
		- 减少网络带宽消耗
	* 浏览器缓存机制
		- 第一次： 浏览器请求 - 无缓存 - 向web服务器请求 - 请求响应，缓存协商 - 结束
		- 第二次：浏览器自己检查：过期要和服务器协商Etag策略和last-modified策略
	* 了解两种缓存策略
		- 强制缓存与对比缓存
		- etag/if 。。。。。。。。
5. http、https和http2的协议
	* https协议分析
		- 和http是两种不同协议，是基于http的，在http2出现之前可一理解为为http加密版本。但是现在不能这么理解，当前使用ssl、tls协议，tls是核心协议，规定了连接流程
		- 数字证书：是一个方案，识别身份的，有CA签发（安全性搞得很好）赛门铁克安全性很高
		- https协议、ssl协议（一种记录协议，目录，核心就是加密的算法和方案）、tls协议（内容）、握手协议（内容）。算法库都来源于一个ssl（openssl：安全性的基础，出过一次事）库。大公司不用开源的，用自己加密实现
	* http2协议分析
		- 默认带加密连接的，协议名称也是https，但是https已经事链路了
		- 使用二进制格式传输、
		- 报错（协议版本不兼容）
		- 在request请求头前面加：叫做伪头，是经过第二次协商之后刷出来的，为了访问第一次的请求勾选preservs就是http2
	* http3协议分析
		- 
	* 
6. http和反向代理
7. nginx配置
8. 最大限度提高学习效率
	* 提前预习
	* 听课并记到笔记本上的笔记
	* 需要再整理
